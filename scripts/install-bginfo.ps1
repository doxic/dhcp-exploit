if (!(Test-Path 'c:\sysinternals')) {
  New-Item -Path 'c:\sysinternals' -type directory -Force -ErrorAction SilentlyContinue
}
if (!(Test-Path 'c:\sysinternals\bginfo.exe')) {
  (New-Object Net.WebClient).DownloadFile('http://live.sysinternals.com/bginfo.exe', 'c:\sysinternals\bginfo.exe')
}
$vbsScript = @'
WScript.Sleep 15000
Dim objShell
Set objShell = WScript.CreateObject( "WScript.Shell" )
objShell.Run("""c:\sysinternals\bginfo.exe"" /accepteula ""c:\sysinternals\bginfo.bgi"" /silent /timer:0")
'@

$vbsScript | Out-File 'c:\sysinternals\bginfo.vbs'

Copy-Item "C:\vagrant\scripts\bginfo.bgi" 'c:\sysinternals\bginfo.bgi'

if (!(Test-Path 'c:\Program Files\sysinternals\bginfo.bgi')) {
  (New-Object Net.WebClient).DownloadFile('https://github.com/StefanScherer/adfs2/raw/master/scripts/bginfo.bgi', 'c:\sysinternals\bginfo.bgi')
}

Set-ItemProperty HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run -Name bginfo -Value 'wscript "c:\sysinternals\bginfo.vbs"'
